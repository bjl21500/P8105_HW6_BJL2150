---
title: "P8105_HW6_BJL2150"
author: "Briana Lettsome"
date: "November 16, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)



library(tidyverse)
library(dplyr)
library(mgcv)
```

# Problem 1

```{r}
# Reading in the homicide data set
homicide_data = read_csv("./homicidedata.csv", na = c("", "NA", "Unknown")) 
```
  

read_csv(file = "./homicidedata.csv")


### Description of the homicide dataset:

The homicide_data  provides information on the numbers of homicides committed within fifty large U.S. cities. Within the dataset, the observations included are the vitcims' first and last name, age, race, city and state that the event transpired in as well as the disposition. The disposition in this context refers to the result of the homicide event. In other words, was the case closed, an arrest made, unsolved, et cetera. 

```{r}
# Making of the new variable 'city_state'. Also, created a binary variable from disposition and named this new observation 'solved'. Where 1 = "Closed by arrest" and = "Open/ no arrest" and "Closed withou arrest".

# Using this dataframe to count how many states are in the original dataset prior to filtering out the 4 city_state observations. 

two_homicide_citystate = homicide_data %>%
  mutate(city_state = str_c(city, ", " , state)) %>%
  mutate(solved = as.numeric(disposition == "Closed by arrest")) %>% 
  count(city_state)  

# This is the working dataframe where the 4 cities were filtered out successfully. The 

homicide_citystate = homicide_data %>%
  mutate(city_state = str_c(city, ", " , state)) %>% 
  mutate(solved = as.numeric(disposition == "Closed by arrest")) %>% 
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>%
  select(city_state, victim_race, solved, victim_age, victim_sex, disposition) %>%
  mutate(race = case_when(victim_race == "White" ~ "white",
                          victim_race != "White" ~ "non-white")) %>%
  mutate(victim_age = as.numeric(victim_age)) %>%
  mutate(race = fct_relevel(race, "white")) %>%
  filter(race != "" & victim_age != "")
```


```{r}
baltimore = homicide_citystate %>%
  filter(city_state == "Baltimore, MD")

## Using the 'glm' function

glm(solved ~ victim_age + race + victim_sex, data = baltimore, family = binomial()) %>%
  broom::tidy(conf.int = TRUE) %>%
  mutate(OR = exp(estimate)) %>%
  mutate(exp_conf_low = exp(conf.low)) %>%
  mutate(exp_conf_high = exp(conf.high)) %>%
  select(term, OR, exp_conf_low, exp_conf_high, p.value) %>%
  knitr::kable(digits = 3)

city_state_glm = homicide_citystate %>%
  group_by(city_state) %>%
  nest()%>%
  mutate(models = map(data, ~glm(solved ~ victim_age + race + victim_sex, data = .x, family = binomial())),
models = map(models, broom::tidy, conf.int = TRUE)) %>%
  select(-data) %>% 
  unnest()
```

output <- df %>%
  select(-am) %>%
  names() %>%
  paste('am~',.) %>%
  map_df(~tidy(glm(as.formula(.x), 
               data= df, 
               family = "binomial"), 
               conf.int=TRUE, 
               exponentiate=TRUE))
               
manhattan_nest_lm_res =
  manhattan_airbnb %>% 
  group_by(neighborhood) %>% 
  nest() %>% 
  mutate(models = map(data, ~lm(price ~ stars + room_type, data = .x)),
         models = map(models, broom::tidy)) %>% 
  select(-data) %>% 
  unnest()

data_frame(formulas) %>%
    mutate(mod = map(formulas, 
                      ~  glm(as.formula(.),
                             family = 'binomial', data = mtcars)))
                             
 my_lm <- function(df){
    lm(Count ~ Moisture, data = df)
}

  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>%
  select(city_state, victim_race, outcome, victim_age, victim_sex) %>%
  mutate(race = case_when(victim_race == "White" ~ "white",
                          victim_race != "White" ~ "non-white")) %>%
  mutate(victim_age = as.numeric(victim_age)) %>%
  filter(race != "" & victim_age != "") 



    

%>% filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>%
  select(city_state, victim_race, solved, victim_age)



 resolution = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved"
    )
    
%>%
  mutate(race = (victim_race == "White"))
  

 
unique(homicide_citystate$city_state)


# Used this function to determine th unique observations within 'disposition'.

unique(homicide_citystate$disposition)

# Problem 2

## Problem 2.1

```{r}
# Reading in of birthweight dataset and removing ony observations that are missing, NA or Unknown.

birthweight_data = read_csv("./birthweight.csv", na = c("", "NA", "Unknown")) 
```

## Problem 2.2

### Linear Regression model for birthweight.

```{r}
birthweight_clean = birthweight_data %>%
  select(bwt, momage, mrace, smoken, babysex, bhead, blength, gaweeks) 

bw_linear_one = lm(bwt ~ momage + mrace + smoken, data = birthweight_clean)

bw_linear_one %>%
  broom::tidy()
```

## Problem 2.3

### Add::residuals and add::predictions to plot residuals against fitted values.

```{r}
# Using the add::residuals and add:predictions to observe the output for my linear model.

modelr::add_residuals(birthweight_clean, bw_linear_one)


modelr::add_predictions(birthweight_clean, bw_linear_one)


# Created a scatterplot plotting the residuals against the fitted values.

birthweight_clean %>% 
  modelr::add_residuals(bw_linear_one) %>% 
  modelr::add_predictions(bw_linear_one) %>%
  ggplot(aes(x = pred, y = resid)) + geom_point() +
    labs(
    title = "Model Residuals Against Fitted Values",
    x = "Fitted Values",
    y = "Residuals",
    caption = "Figure 2. Data from birthweight.csv."
  )
```

## Problem 2.3

### Comparison of My Model to Two Others.

```{r}
# The model that I hypothesized.

bw_linear_one = lm(bwt ~ momage + mrace + smoken, data = birthweight_clean)

# Making of the two comparison models.

length_ges_linear = lm(bwt ~ blength + gaweeks, data = birthweight_clean) 

birthweight_clean %>% 
  modelr::add_residuals(length_ges_linear) %>% 
  modelr::add_predictions(length_ges_linear) %>%
  ggplot(aes(x = pred, y = resid)) + geom_point() +
    labs(
    title = "Comparision #1",
    x = "Fitted Values",
    y = "Residuals",
    caption = "Figure 3. Data from birthweight.csv."
  )
linear_interaction = lm(bwt ~ bhead + blength + babysex + bhead*blength*babysex,
                        data = birthweight_clean)

birthweight_clean %>%
  modelr::add_residuals(linear_interaction) %>%
  modelr::add_predictions(linear_interaction) %>%
  ggplot(aes(x = pred, y = resid)) + geom_point()
```

Comparison_df = birthweight_clean %>% 
  gather_predictions(bw_linear_one, length_ges_linear, linear_interaction) %>% 
  mutate(model = fct_inorder(model)) %>% 
  ggplot(aes(x = pred, y = resid())) + 
  geom_point() + 
  geom_line(aes(y = pred), color = "red") + 
  facet_wrap(~model)



```
